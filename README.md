# STM32 BME680 Environmental Sensor Project

This project interfaces the **BME680 sensor** (temperature, humidity, pressure, gas resistance) with an STM32 microcontroller (tested on STM32F413H-DISCO) using I2C and outputs data via UART. Built with STM32CubeIDE and Bosch's BME68x driver.

Project Overview

---

## Table of Contents

- [STM32 BME680 Environmental Sensor Project](#stm32-bme680-environmental-sensor-project)
  - [Table of Contents](#table-of-contents)
  - [Features](#features)
  - [Hardware Setup](#hardware-setup)
    - [Components](#components)
  - [Software Setup](#software-setup)
    - [Prerequisites](#prerequisites)
    - [Steps](#steps)
  - [Configuration](#configuration)
    - [Key Code Snippets](#key-code-snippets)
  - [Code Structure](#code-structure)
  - [Example Output](#example-output)
    - [Command for Mac](#command-for-mac)
  - [References](#references)
    - [Official Resources](#official-resources)
    - [STM32 Implementations](#stm32-implementations)
    - [Tutorials](#tutorials)
  - [License](#license)
  - [Refernces](#refernces)

---

## Features

- **Sensor Integration**:
    - I²C communication with BME680 (address `0x77`)
    - Measures temperature, humidity, pressure, and gas resistance
    - Heater control for gas sensor calibration
- **Debugging**:
    - UART output (115200 baud)
    - I²C bus scanning
- **Error Handling**:
    - Initialization checks
    - Float formatting support for `printf`

---

## Hardware Setup

### Components

| Component | Connection |
| :-- | :-- |
| STM32F413H-DISCO | - |
| BME680 Sensor | I²C (SCL: PB10, SDA: PB11) |
| USB-to-UART Converter | PG14 (TX), PG9 (RX) |

**Wiring**:

```
BME680 <-> STM32
-----------------
VCC    -> 3.3V
GND    -> GND
SCL    -> PB10 (I2C2_SCL)
SDA    -> PB11 (I2C2_SDA)
```

---

## Software Setup

### Prerequisites

- STM32CubeIDE v1.13+
- [BME68x Driver](https://github.com/BoschSensortec/BME68x-Sensor-API) (v4.4.8)
- Terminal emulator (Tera Term, PuTTY)


### Steps

1. **Clone Project**:

```bash
git clone https://github.com/kpf5297/STM32-Development.git
```

2. **Import BME68x Driver**:
    - Add `bme68x.c`, `bme68x.h`, `bme68x_defs.h` to `Drivers/BME68x/`
3. **Configure STM32CubeIDE**:
    - Enable I2C2 (PB10/PB11) and USART6 (PG14/PG9)
    - Add linker flag: `-u _printf_float` (Project Properties > C/C++ Build > Settings)

---

## Configuration

### Key Code Snippets

**I²C Initialization**:

```c
static void MX_I2C2_Init(void) {
  hi2c2.Instance = I2C2;
  hi2c2.Init.ClockSpeed = 400000; // 400 kHz
  // ... (generated by STM32CubeMX)
}
```

**Sensor Setup**:

```c
struct bme68x_dev bme680 = {
  .chip_id = BME68X_CHIP_ID, // 0x61
  .intf = BME68X_I2C_INTF,
  .intf_ptr = &dev_addr,     // 0x77
  .read = bme68x_i2c_read,
  .write = bme68x_i2c_write,
  .delay_us = bme68x_delay_us
};
```

---

## Code Structure

```
├── Core/
│   ├── Inc/
│   ├── Src/
│   │   └── main.c           # Main application logic
├── Drivers/
│   ├── BME68x/             # Bosch sensor driver
│   ├── STM32F4xx_HAL_Driver/
```

---

## Example Output

```
Scanning I2C bus...
Device found at 0x77
BME680 Chip ID: 0x61
Temp: 23.70 C | Hum: 31.79 % | Press: 974.70 hPa | Gas: 806.52 kΩ
```

---

### Command for Mac
```bash
ls /dev/tty.*  

screen /dev/tty.usbmodem<nnnn> 115200
```

## References

### Official Resources

1. [BME68x Sensor API](https://github.com/BoschSensortec/BME68x-Sensor-API) - Official Bosch driver
2. [BME680 Datasheet](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme680-ds001.pdf)

### STM32 Implementations

3. [BME680-STM32 Example](https://github.com/martinius96/BME680-STM32) - Reference implementation
4. [STM32 Community Forum](https://community.st.com/) - Troubleshooting discussions

### Tutorials

5. [BME680 Arduino Guide](https://randomnerdtutorials.com/bme680-sensor-arduino-gas-temperature-humidity-pressure/)
6. [BSEC Integration Guide](https://www.bosch-sensortec.com/software-tools/software/bme680-software-bsec/)

---

## License

This project is under the MIT license.

**Acknowledgments**:

- Bosch Sensortec for BME68x driver
- STMicroelectronics for STM32CubeIDE
- Martinius96 for STM32 reference implementation

---

NEXT: BSEC integration or advanced IAQ calculations,[Bosch BSEC Library](https://www.bosch-sensortec.com/software-tools/software/bme680-software-bsec/).

## Refernces
https://github.com/martinius96/BME680-STM32

https://community.bosch-sensortec.com/mems-sensors-forum-jrmujtaw/post/examples-of-bme68x-sensor-api-use-coines-h-but-this-file-is-not-included-auxlwrX06TDjU3z

https://community.bosch-sensortec.com/mems-sensors-forum-jrmujtaw/post/problem-reading-data-via-spi---bme680-stm32-CJfalqUhqJOBnpo

https://community.st.com/t5/others-hardware-and-software/interfacing-bosch-bme688-sensor-with-stm32/td-p/747079

https://how2electronics.com/iot-indoor-air-quality-monitoring-with-bme680-bsec-esp8266/

https://community.bosch-sensortec.com/mems-sensors-forum-jrmujtaw/post/bme688-bme680-stm32-VGKvfaeMNXaOPfM


